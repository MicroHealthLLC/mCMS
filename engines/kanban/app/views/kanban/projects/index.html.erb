
  <%= stylesheet_link_tag 'kanban/application' %>
  <%= stylesheet_link_tag 'kanban/themes/default-bright', id:"themeStylesheet"%>

<div ng-app="mpk">
<!--[if lt IE 7]>
<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
<div ng-view>
</div>

<script type="text/ng-template" id="kanban.html">

  <div class="row btn-edition">
    <div class="col-xs-12">
      <div id="quickSwitch" style="padding: 0 10px" class="pull-right form-group">
        <select ng-model="switchTo" ng-options="name for name in switchToList" ng-change="switchToKanban(switchTo)">
          <option>Switch to ...</option>
        </select>
      </div>

      <% if User.current.can?(:manage_kanban_projects, :manage_roles) %>
          <a class="mpkNew btn btn-primary pull-right" title="New Kanban board" ng-click="kanbanMenu.openNewKanban()"><i class="glyphicon glyphicon-briefcase"></i> New</a>
          <a class='btn btn-danger pull-right' title="Delete Kanban" ng-click="kanbanMenu.delete()"><i class="glyphicon glyphicon-remove-sign"></i> Delete</a></li>
          <% if User.current.last_project_used_id %>
              <a class='btn btn-primary pull-right' href="/kanban/projects/manage_users"> Manage Users</a>
          <% end %>
      <% end %>
      <a class='btn btn-info pull-right' title="Open archive" ng-click="kanbanMenu.openArchive(kanban)"><i class="glyphicon glyphicon-folder-open"></i> Archives</a></li>
    </div>
  </div>
  <nav class="navbar">
    <div class="navbar-inner">
      <div class="row">
        <div class="navbar-header col-md-3">
          <span id="kanbanName" class="navbar-brand" ng-model="kanban" ng-hide="editingName"><a class="renameKanban" ng-click="editingKanbanName()">{{kanban.name}}</a></span>
          <div ng-show="editingName" class="pull-left">
            <form ng-submit="rename()" >
              <div class="input-group">
                <span class="input-group-addon">
                  <a ng-click="editingName=false"><i class="glyphicon glyphicon-tasks"></i></a>
                </span>
                <input type="text" name="kanbanName" ng-model="newName" class="form-control" />
              </div>
             </span>
                <input type="submit" class="glyphicon glyphicon-ok"/>
            </form>
          </div>
        </div>
        <div class="col-md-9">

          <div id="info" class="nav pull-right" ng-show="showInfo">
            <span id="error" class="error" ng-show="showError"><a ng-click="showInfo=false;showError=false;errorMessage=''">{{errorMessage}}</a></span>
            <span id="message" class="">{{infoMessage}}</span>
            <span id="spinner" class="pull-right" spin="spinConfig" spin-if="showSpinner"></span>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid" id="kanban" ng-controller="KanbanController">
    <div id="columns">
      <div style="width: {{columnWidth}}%;display: inline-block;" ng-repeat="column in kanban.columns" data-columnindex="{{$index}}" id="column{{$index}}">
        <div class="column" style="background-color: {{column.settings.color}}">
          <div class="columnHeader">
            <a title="Column settings" ng-click="columnSettings(kanban, column)" ng-model="column" ng-hide="editing"><i class="glyphicon glyphicon-wrench"></i></a>
            <a title="Add card to column" class="pull-right" ng-click="addNewCard(column)" ng-hide="columnLimitsReached(column)"><i class="glyphicon glyphicon-plus"></i></a>
            <span>{{column.name}} ({{columnLimitsTextFor(column)}})</span>
          </div>
          <ul ng-class="sortableClassFor(column)" ui-sortable="{connectWith: '#kanban ul.cards'}" ng-model="column.cards" style="min-height:{{columnHeight}}px;max-height:{{columnHeight}}px;">
            <li class="card" ng-repeat="card in column.cards" style="background-color: #{{colorFor(card)}};">
              <a class="pull-right" ng-click="delete(card, column)"><i class="glyphicon glyphicon-remove"></i></a>
              <a class="pull-right" title="Archive" ng-click="archive(kanban, column, card)" ng-show="isLastColumn(column.name, kanban)"><i class="glyphicon glyphicon-folder-close"></i></a>
              <a ng-click="openCardDetails(card)"><span>{{card.name}}</span></a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <%= render partial: '/kanban/shared/column_setting_controller' %>
    <%= render partial: '/kanban/shared/new_kanban_card_controller' %>
    <%= render partial: '/kanban/shared/card_controller' %>
  </div>
  <%= render partial: '/kanban/shared/new_kanban_controller' %>
  <%= render partial: '/kanban/shared/switch_theme_controller' %>
  <%= render partial: '/kanban/shared/archive_controller' %>
  <%= render partial: '/kanban/shared/import_export_controller' %>


  <!-- Cloud stuff from here -->
</script>
<footer></footer>
<%= javascript_include_tag 'kanban/application' %>
</div>

